<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- Enabling site copy protection 
    <script src="https://unpkg.com/website_security@latest"></script> -->
    <base href="https://ustinnovcorpgames.ru/animaciya_dvizheniya_na_arjs/" target="_blank">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Простая анимация движения модели">
    <meta name="author" content="Устинов Дмитрий Сергеевич | moyustimov@vk.com | ustinnov.ru">
    <meta http-equiv="content-language" content="ru">
    <meta property="og:title" content="Анимация движения на AR.js">
    <meta property="og:image" content="../common/pictures/illustrations/animaciya_dvizheniya_na_arjs.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:description" content="Простая анимация движения модели">
    <meta property="og:url" content="https://ustinnovcorpgames.ru/animaciya_dvizheniya_na_arjs/">
    <meta property="og:type" content="article">
    <title>Анимация движения на AR.js</title>
    <link rel="icon" href="../common/pictures/icons/favicon.ico">
    <!-- UiKit connection -->
    <link rel="stylesheet" href="../common/uikit/css/uikit.min.css">
    <script src="../common/uikit/js/uikit.min.js"></script>
    <script src="../common/uikit/js/uikit-icons.min.js"></script> 
    <!-- Yandex.RTB -->
    <script>window.yaContextCb=window.yaContextCb||[]</script>
    <script src="https://yandex.ru/ads/system/context.js" async></script>
    <!-- To display the aside tag in internet explorer -->
    <script>
        document.createElement('aside');
    </script>
    <!-- For browser support -->
    <!--[if IE]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Connecting your own files -->
    <link rel="stylesheet" href="../common/custom/styles/index.css">
</head>
<body>
    <div class="uk-child-width-expand" uk-grid>
        <div class="uk-width-3-4@m">
            <header>
                <div class="uk-padding">
                    <p class="uk-text-lead uk-text-italic">AR.js и A-Frame уроки: погружение в WebAR</p> 
                </div>
            </header>
            <div class="uk-padding">
                <main>
                    <section>
                        <header>
                            <div class="uk-margin-large-bottom">
                                <h1>
                                    Анимация движения на AR.js 
                                </h1> 
                                <p class="uk-text-meta">
                                    Последнее обновление - 30 ноября 2024 года
                                </p>
                            </div> 
                            <!-- <p>
                                <img src="../common/pictures/illustrations/pervoe_ar_prilozhenie.png" alt="AR illustration" loading="lazy">
                            </p> -->
                        </header>
                        <section>
                            <header>
                                <div class="uk-margin-medium-bottom">
                                    <h2>
                                        Оживление модели: движение по кругу
                                    </h2>
                                </div>
                            </header>
                            <div class="uk-article">
                                <p class="uk-text-bold">Краткая инструкция</p>
                                <p>
                                    Доброго дня, уважаемые читатели. Сегодня будем оживлять нашу модель. 
                                </p>
                                <p>
                                    План действий следующий: 
                                </p>
                                <p>
                                    <ul>
                                        <li>
                                            1. Меняем модель 
                                        </li>
                                        <li>
                                            2. Меняем её размеры
                                        </li>
                                        <li>
                                            3. Заставляем двигаться по кругу
                                        </li>
                                    </ul>
                                </p>
                                <p>
                                    Всё просто. Поехали!
                                </p>
                            </div>
                            <div class="uk-article">
                                <p class="uk-text-bold">1. Смена модели</p>
                                <p>
                                    Итак, первым делом мы заменим модель шлема на, более подходящую модель для такого урока, модель утки, лишь изменив ссылку. 

<code class="area_code">gltf-model=&quot;https://cdn.rawgit.com/KhronosGroup/glTF-Sample-Models/master/2.0/Duck/glTF/Duck.gltf&quot;</code>

                                </p>
                            </div>
                            <div class="uk-article">
                                <p class="uk-text-bold">2. Изменение размеров</p>
                                <p>
                                    Теперь немного уменьшим размер, так как утка по прежнему размеру получалась слегка большой, неудобно было смотреть. 

<code class="area_code">scale=&quot;0.4 0.4 0.4&quot;</code>

                                </p>
                            </div>
                            <div class="uk-article">
                                <p class="uk-text-bold">3. Добавляем движения</p>
                                <p>
                                    А сейчас самое главное - мы заставим её плавать по кругу. 

Для этого напишем простенький js-код. У нас же всё таки AR.js библиотека. 

Вот код. Его мы размещаем в теге script _после_ AR-кода (-иначе не будет работать-).

<script>
    const model = document.getElementById('rotating-model');
    let angle = 0;

    function animate() {
        angle += 0.02; // Скорость вращения
        // Координаты орбиты
        model.object3D.position.x = Math.cos(angle) * 1; // Радиус орбиты
        model.object3D.position.z = Math.sin(angle) * 1; // Радиус орбиты
        
        requestAnimationFrame(animate);
    }

    animate();
</script>

А вот объяснения, что он делает. 

В первой строке мы берём модель в переменную, данное действие будет применять всю анимацию к нашей модели. 
Используется getElementById для поиска модели в коде по id привязанному к ней.

Для этого необходимо поставить id="rotating-model" рядом с атрибутами a-entity, чтобы было вот так: 

<a-entity id="rotating-model"></a-entity>

Кстати, атрибут position убираем, так как он теперь лишний. 

Далее вкратце расскажу что делают оставшиеся строки...

<ul>
    <li>
        let angle = 0;
    </li>
    <li>
        Инициализация переменной angle, которая хранит текущий угол вращения модели. Начальное значение равно 0 радиан.
    </li>
    <li>
        function animate()
    </li>
    <li>
        Объявление функции animate, которая будет выполнять анимацию модели. Эта функция будет вызываться многократно с помощью requestAnimationFrame.
    </li>
    <li>
        angle += 0.02; // Скорость вращения
    </li>
    <li>
        Увеличение угла вращения на 0.02 радиана при каждом вызове функции animate. Это определяет скорость вращения модели.
    </li>
    <li>
        model.object3D.position.x = Math.cos(angle) * 1; // Радиус орбиты
    </li>
    <li>
        Вычисление новой позиции по оси X для модели. Используется функция Math.cos(angle) для определения X-координаты, которая размещает модель на круговой орбите с радиусом 1.
    </li>
    <li>
        model.object3D.position.z = Math.sin(angle) * 1; // Радиус орбиты
    </li>
    <li>
        Вычисление новой позиции по оси Z. Здесь Math.sin(angle) используется для определения Z-координаты, что позволяет получать округлую траекторию вращения.
    </li>
    <li>
        requestAnimationFrame(animate);
    </li>
    <li>
        Вызов функции requestAnimationFrame, чтобы продолжить анимацию. Это обеспечивает плавную анимацию путем запроса следующего кадра, где снова будет вызвана функция animate.
    </li>
    <li>
        animate();
    </li>
    <li>
        Первая инициализация анимации. После определения функции animate мы вызываем её, чтобы стартовать процесс вращения модели.
    </li>
</ul>

Таким образом, данный код осуществляет плавное вращение 3D-модели вокруг центра по круговой траектории с фиксированным радиусом.

                                </p>
                            </div>
                            <div class="uk-article uk-margin-medium-bottom">
                                <p class="uk-text-bold">В итоге мы получаем следующий код нашего обновленного приложения:</p>
                                <p>
                                    <pre><code class="language-html">&lt;!DOCTYPE html&gt;
                                        &lt;html lang=&quot;ru&quot;&gt;
                                        &lt;head&gt;
                                            &lt;meta charset=&quot;UTF-8&quot;&gt;
                                            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0&quot;&gt;
                                            &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;
                                            
                                            &lt;title&gt;Animation example&lt;/title&gt;
                                                
                                            &lt;script src=&quot;ar_libraries/aframe-master/aframe-master/dist/aframe-v1.6.0.min.js&quot;&gt;&lt;/script&gt;
                                            &lt;script src=&quot;ar_libraries/AR.js-3.4.0/aframe/build/aframe-ar.js&quot;&gt;&lt;/script&gt;
                                        &lt;/head&gt;
                                        &lt;body&gt;
                                            &lt;a-scene embedded arjs&gt;
                                                &lt;a-marker preset=&quot;hiro&quot;&gt;
                                                    &lt;a-entity 
                                                        id=&quot;rotating-model&quot; 
                                                        gltf-model=&quot;https://cdn.rawgit.com/KhronosGroup/glTF-Sample-Models/master/2.0/Duck/glTF/Duck.gltf&quot;
                                                        scale=&quot;0.4 0.4 0.4&quot;
                                                    &gt;
                                                    &lt;/a-entity&gt;
                                                &lt;/a-marker&gt;
                                                &lt;a-entity camera&gt;&lt;/a-entity&gt;
                                            &lt;/a-scene&gt;
                                           
                                           &lt;script&gt;
                                                const model = document.getElementById('rotating-model');
                                                let angle = 0;
                                            
                                                function animate() {
                                                    angle += 0.02; // Скорость вращения
                                        
                                                    // Координаты орбиты
                                                    model.object3D.position.x = Math.cos(angle) * 1; // Радиус орбиты
                                                    model.object3D.position.z = Math.sin(angle) * 1; // Радиус орбиты
                                                    
                                                    requestAnimationFrame(animate);
                                                }
                                            
                                                animate();
                                           &lt;/script&gt;
                                        &lt;/body&gt;
                                        &lt;/html&gt;</code></pre>
                                </p>
                            </div>
                        </section>
                        <footer></footer>
                    </section>
                </main>
                <article>
                    <div class="uk-article uk-margin-medium-bottom">
                        <header>
                            <div class="uk-margin-medium-bottom">
                                <h2>
                                    Помощь
                                </h2>
                            </div>
                        </header>
                        <div>
                            <!-- connecting to a third-party commenting library -->
                            <div id="sigCommentsBlock"></div>
                            <a href="http://sigcomments.com" style="font-size: 0.6em;">Система комментирования SigComments</a>
                            <script type="text/javascript">
                                (function(){
                                    var host_id = '7272';
                                    var script = document.createElement('script');
                                    script.type = 'text/javascript';
                                    script.async = true;
                                    script.src = '//sigcomments.com/chat/?host_id='+host_id;
                                    var ss = document.getElementsByTagName('script')[0]; 
                                    ss.parentNode.insertBefore(script, ss);
                                })();
                            </script>
                        </div>
                    </div>
                </article>
                <footer>
                    <div class="uk-text-muted uk-text-center">
                        Created by Ustinov Corporation
                    </div>
                </footer>
            </div>
        </div>
        <aside>
            <div class="uk-text-center uk-margin-medium-top" uk-sticky="position: right">
                <div class="uk-margin-medium-bottom">
                    <div class="uk-margin-small-bottom">
                        <address>
                            <a target="_blank" rel="external nofollow noopener" href="https://t.me/moyustimov">Написать мне</a>
                        </address>
                    </div>
                    <p>
                        <a target="_blank" rel="external nofollow noopener" href="https://t.me/+NgVMW9SB-EwwZTMy">Помощь AR.js программистов</a>
                    </p>
                </div>
                <div class="uk-margin-medium-bottom">
                    <a href="../index.html#base_links">
                        <button class="uk-button uk-button-primary">
                            Больше статей
                        </button>  
                    </a>                   
                </div>
                <div>
                    <!-- Yandex.RTB R-A-6817575-1 -->
                    <div id="yandex_rtb_R-A-6817575-1"></div>
                    <script>
                        window.yaContextCb.push(()=>{
                            Ya.Context.AdvManager.render({
                                "blockId": "R-A-6817575-1",
                                "renderTo": "yandex_rtb_R-A-6817575-1"
                            })
                        })
                    </script>
                </div>
            </div>
        </aside>
    </div>
    <footer></footer>
</body>